# Django static files configuration
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Block any attempts to access external CDNs
    RewriteCond %{HTTP_REFERER} speedcdnjs\.com [NC]
    RewriteRule ^(.*)$ - [F,L]
    
    RewriteCond %{HTTP_REFERER} cdnjs\.cloudflare\.com [NC]
    RewriteRule ^(.*)$ - [F,L]
    
    # Serve static files directly with proper headers
    RewriteCond %{REQUEST_URI} ^/static/
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(.*)$ $1 [L]
    
    # Serve admin static files
    RewriteCond %{REQUEST_URI} ^/admin/static/
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(.*)$ $1 [L]
    
    # All other requests go to Django
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ passenger_wsgi.py/$1 [L]
</IfModule>

# Set proper MIME types for CSS files
<IfModule mod_mime.c>
    AddType text/css .css
    AddType application/javascript .js
    AddType image/png .png
    AddType image/jpg .jpg
    AddType image/jpeg .jpeg
    AddType image/gif .gif
    AddType image/svg+xml .svg
</IfModule>

# Enable compression for static files
<IfModule mod_deflate.c>
    <FilesMatch "\.(css|js|html|xml|txt)$">
        SetOutputFilter DEFLATE
    </FilesMatch>
</IfModule>

# Set cache headers for static files
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
</IfModule>

# Security headers to prevent external resource loading
<IfModule mod_headers.c>
    # Prevent loading of external resources
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';"
    
    # Prevent clickjacking
    Header always set X-Frame-Options "DENY"
    
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"
</IfModule> 